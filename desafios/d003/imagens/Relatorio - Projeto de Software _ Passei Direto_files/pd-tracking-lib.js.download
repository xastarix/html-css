var pdTrackingLib=function(){var e={utils:{},services:{}};return e.utils.ajaxRequest=function(){function e(e,n,t,i,s,o){const a=window.location.host.indexOf(".studenta.com")>-1?n.replace(".passeidireto.com",".studenta.com"):n;var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState==XMLHttpRequest.DONE)if(r.status>=200&&r.status<=299)s(r.responseText&&""!=r.responseText?JSON.parse(r.responseText):null);else{o({status:r.status,data:r.responseText});const e=new CustomEvent("httpErrorEvent",{detail:{error:{response:r}}});window.dispatchEvent(e)}},r.open(e,a,!0),r.withCredentials=!0,r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("pd-app-client-id",i.id||i.name),r.setRequestHeader("pd-app-client-version",i.version),"POST"==e?r.send(JSON.stringify(t)):r.send()}return{ajaxRequest:e}}(),e.utils.cookies=function(){function n(e){var n=document.cookie.match(new RegExp(e+"=([^;]+)"));try{n&&(n=JSON.parse(n[1]))}catch(t){n&&(n=n[1])}return n}function t(e,n){n=n||a,document.cookie=[e,"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=",n].join("")}function i(e,n){var t=[e,"=",JSON.stringify(n),"; domain=",a,"; path=/;"].join("");document.cookie=t}function s(e,n){if(!n[e]||"function"!=typeof n[e])throw new Error("Invalid "+e+" function")}function o(n){s("setCookie",n),s("getCookie",n),s("removeCookie",n),Object.assign({},e.utils.cookies,n)}var a=window.location.host.indexOf(".studenta.com")>-1?".studenta.com":".passeidireto.com";return{setCookie:i,getCookie:n,removeCookie:t,overrideCookiesUtils:o}}(),e.utils.debounce=function(){function e(e,n,t){var i;return function(){var s=this,o=arguments,a=function(){i=null,t||e.apply(s,o)},r=t&&!i;clearTimeout(i),i=setTimeout(a,n),r&&e.apply(s,o)}}return{debounce:e}}(),e.services.eventTracking=function(){function n(e){o=e}function t(){return window.location.search.slice(1).split("&").filter(function(e){return e.startsWith("pd_")}).join("&")}function i(n,i,s){i.PdUtm=t();var a={SessionId:s,EventName:n,Data:i,TrackingLibVersion:"16.0.23"};console.log("[PD Tracking Lib]",n,JSON.stringify(a));var r="https://tracking-api.passeidireto.com",c=r+"/track";e.utils.ajaxRequest.ajaxRequest("POST",c,a,o.clientData,function(){},function(e){console.error("[PD Tracking Lib] Something went wrong with event tracking",e)})}function s(n,t,a){var r=e.services.sessionTracking.getSessionId(),c=parseInt("500"),u=parseInt("10000")/c;r>0||o&&o.anonymous?i(n,t,r):u>a?(console.warn("[PD Tracking Lib] Session Tracking is not ready, delaying to send. Attempt:",++a),setTimeout(function(){s(n,t,a)},c)):console.error("[PD Tracking Lib] Session Tracking is not ready, giving up")}var o;return{track:function(e,n){return s(e,n,0)},init:n}}(),e.services.materialReadTracking=function(){function n(n){c=n,e.services.sessionActivity.isSessionActive()?(t(),r=setInterval(function(){e.services.eventTracking.track("MaterialRead",{MaterialId:n,MaterialReadInterval:a})},a),e.services.sessionActivity.bindSessionInactiveCallback(s)):s()}function t(){r&&(clearInterval(r),r=null),e.services.sessionActivity.unbindSessionInactiveCallback(s),e.services.sessionActivity.unbindSessionActiveCallback(i)}function i(){n(c),e.services.sessionActivity.unbindSessionActiveCallback(i)}function s(){t(),e.services.sessionActivity.bindSessionActiveCallback(i)}function o(){t(),c=null}const a=parseInt("10000");var r,c;return{startMaterialRead:n,stopMaterialRead:o}}(),e.services.materialWatchedTracking=function(){function n(n){r=n,t(),a=setInterval(function(){e.services.eventTracking.track(o,{MaterialId:n,MaterialWatchedInterval:s,OnTab:!document.hidden})},s)}function t(){a&&(clearInterval(a),a=null)}function i(){t(),r=null}const s=parseInt("10000"),o="MaterialWatched";var a,r;return{startMaterialWatched:n,stopMaterialWatched:i}}(),e.services.sessionActivity=function(){function n(e){if(!e.anonymous&&(!e.userId||e.userId<1))throw new Error("Invalid userId");if(!e.currentLocation)throw new Error("Invalid currentLocation");if(!e.clientData)throw new Error("Invalid clientData");if((!e.clientData.id||e.clientData.id<1)&&!e.clientData.name)throw new Error("Invalid clientData.id and clientData.name");if(!e.clientData.version)throw new Error("Invalid clientData.version")}function t(t,i,s){i="undefined"==typeof i?function(){}:i,s="undefined"==typeof s?function(){}:s,n(t),k=t,e.services.sessionTracking.init(k),e.services.eventTracking.init(k),t.anonymous?i():e.services.sessionTracking.trackSession(i,s)}function i(){o(),e.services.sessionTracking.trackSession()}function s(){o(!0)}function o(e){g?clearTimeout(g):e||(console.log("[PD Tracking Lib]","Session active"),setTimeout(function(){p.forEach(function(e){e()})})),g=setTimeout(function(){g=null,console.log("[PD Tracking Lib]","Session inative"),h.forEach(function(e){e()})},e?0:f)}function a(e){p.push(e)}function r(e){var n=p.indexOf(e);p.splice(n,1)}function c(e){h.push(e)}function u(e){var n=h.indexOf(e);h.splice(n,1)}function l(){return!!g}var d=e.utils.debounce;const v=500,f=parseInt("600000");var k,g,p=[],h=[];const m=d.debounce(i,v);return{initSession:t,userActivityEventListener:m,userInactivityEventListener:s,bindSessionActiveCallback:a,unbindSessionActiveCallback:r,bindSessionInactiveCallback:c,unbindSessionInactiveCallback:u,isSessionActive:l}}(),e.services.sessionTracking=function(){function n(e){const n=l.clientData.id;return e+"_"+n}function t(e){l=e}function i(e){return"number"==typeof e&&e>0}function s(){e.utils.cookies.removeCookie(n(r)),e.utils.cookies.removeCookie(n(c))}function o(t,o){const a=window.location.href,d=document.referrer,v=e.utils.cookies.getCookie("first_accessed_page"),f=e.utils.cookies.getCookie("first_accessed_page_referer"),k=l.countryId?l.countryId:null,g=l.userId,p=l.languageId?l.languageId:null,h=l.host?l.host:null;e.utils.cookies.setCookie(n(r),(new Date).toISOString());var m="https://session-tracking-api.passeidireto.com",T=m+"/session/"+g+"/track";const y={currentUrl:a,referrerUrl:d,FirstAccessedPage:v,FirstAccessedPageReferrer:f,countryId:k,languageId:p,host:h};console.log("[PD Tracking Lib]","SessionTracking",JSON.stringify(y)),e.utils.ajaxRequest.ajaxRequest("POST",T,y,l.clientData,function(a){a&&i(a.SessionId)?(u=a.SessionId,e.utils.cookies.setCookie(n(c),u),t()):(u=-1,s(),o())},function(e){console.error("[PD Tracking Lib] Something went wrong with session tracking",e),u=-1,s(),o(e)})}function a(t,s){t="undefined"==typeof t?function(){}:t,s="undefined"==typeof s?function(){}:s;var a=e.utils.cookies.getCookie(n(r)),l=e.utils.cookies.getCookie(n(c));if(!a||!l)return o(t,s);a=new Date(a);var d=new Date,v=Math.abs(a-d);v>=parseInt("3600000")?o(t,s):i(u)||(u=l,t())}const r="last-session-tracking-call",c="last-session-tracking-id";var u,l;return{init:t,trackSession:a,getSessionId:function(){return u},getSessionKey:function(){return l.sessionKey}}}(),{overrideCookiesUtils:e.utils.cookies.overrideCookiesUtils,initSession:e.services.sessionActivity.initSession,userActivityEventListener:e.services.sessionActivity.userActivityEventListener,userInactivityEventListener:e.services.sessionActivity.userInactivityEventListener,trackEvent:e.services.eventTracking.track,startMaterialRead:e.services.materialReadTracking.startMaterialRead,stopMaterialRead:e.services.materialReadTracking.stopMaterialRead,startMaterialWatched:e.services.materialWatchedTracking.startMaterialWatched,stopMaterialWatched:e.services.materialWatchedTracking.stopMaterialWatched,version:"16.0.23"}}();